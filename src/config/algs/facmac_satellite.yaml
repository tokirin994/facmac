# --- FACMAC (Factored Multi-Agent Centralised Policy) for Satellite Scenario ---
# 基础配置
action_range: [-1.0, 1.0]  # 卫星动作范围（如姿态角/推力控制，归一化到[-1,1]）
action_selector: ~         # 连续动作无需离散动作选择器
agent: rnn                 # 卫星状态时序依赖，用RNN捕捉轨道/姿态时序特征
obs_agent_id: True         # 观测包含卫星ID（多卫星编队区分）
obs_last_action: True      # 观测包含上一步动作（卫星动作具有连续性）
agent_output_type: "continuous" # 卫星动作是连续型（轨道/姿态控制）
batch_size_run: 1          # 单轮运行批次大小
batch_size: 64             # 训练批次（卫星数据样本量大，适度增大）
buffer_size: 100000       # 经验回放缓冲区（卫星轨迹数据多，增大容量）
buffer_warmup: 1000       # 预热步数（先收集一定量卫星轨迹数据再训练）
discretize_actions: False  # 卫星动作连续（如推力、角速度，不离散化）
double_q: True             # 双Q网络减轻过估计（卫星奖励稀疏，提升稳定性）

# 探索策略（适配卫星连续动作探索）
epsilon_decay_mode: ~      # 连续动作不用epsilon-greedy
epsilon_start: ~
epsilon_finish: ~
epsilon_anneal_time: ~
exploration_mode: "gaussian" # 高斯噪声（卫星动作平滑，避免OU噪声的强震荡）
start_steps: 5000          # 初始随机探索步数（卫星环境先探索轨道空间）
act_noise: 0.05            # 高斯噪声标准差（卫星动作精度要求高，降低噪声）
ou_theta: 0.1              # OU噪声参数（备用，适配卫星缓慢动力学）
ou_sigma: 0.15
ou_noise_scale: 0.2
final_ou_noise_scale: 0.0  # 训练后期关闭探索噪声
ou_stop_episode: 100       # 200个episode后OU噪声衰减至0

# 训练核心超参数（适配卫星长时任务）
gamma: 0.99                # 折扣因子（卫星任务周期长，提升远期奖励权重）
grad_norm_clip: 1.0        # 梯度裁剪（卫星动力学梯度易爆炸，增大裁剪阈值）
learner: "facmac_learner"  # FACMAC专属learner
learn_interval: 1          # 每步训练（卫星轨迹时序紧密）
lr: 0.001                  # 策略网络学习率（卫星环境收敛慢，降低学习率）
critic_lr: 0.001           # 评论家网络学习率
td_lambda: 0.9             # TD(lambda)（卫星长轨迹，提升时序信用分配）
critic_train_reps: 2       # 评论家重复训练次数（卫星奖励稀疏，强化拟合）
q_nstep: 3                 # N步Q学习（捕捉卫星多步轨迹的奖励关联）

# 多智能体与网络配置
mac: "cqmix_mac"          # FACMAC专属多智能体控制器
mixer: qmix                # FACMAC无需全局mixer（因子化评论家）
mixing_embed_dim: 64       # 混合嵌入维度
skip_connections: False
gated: False
hypernet_layers: 1         # 超网络层数
hypernet_embed: 64        # 超网络嵌入维度
hyper_initialization_nonzeros: 0  # 超网络初始化非零权重

name: "facmac_satellite"
n_runners: ~               # 并行运行器数量（加速卫星轨迹收集）
n_train: 1                 # 每次训练迭代次数
optimizer: "adam"          # Adam优化器（适配卫星非凸优化目标）
optimizer_epsilon: 1.0e-2    # 优化器epsilon（提升数值稳定性）
rnn_hidden_dim: 128        # RNN隐藏层维度（卫星状态维度高，增大容量）
run_mode: ~       # 并行运行（卫星环境仿真耗时，并行加速）
runner: "episode"         # 调用parallel_runner（对应runners/__init__.py的REGISTRY）
runner_scope: "episodic"   # 按episode收集数据（卫星任务以episode为周期）

# 目标网络更新（适配卫星慢动力学）
target_update_interval: ~
target_update_mode: "soft" # 软更新（卫星状态变化平滑，避免硬更新震荡）
target_update_tau: 0.005   # 软更新系数（比默认大，加快目标网络跟踪）

# 测试配置（卫星任务评估）
test_greedy: True          # 测试时贪心策略（无探索噪声）
test_interval: 5000        # 每5000步测试（卫星训练周期长，降低测试频率）
test_nepisode: 20          # 每次测试20个episode（提升评估可靠性）
testing_on: True
t_max: 10000             # 总训练步数（卫星任务需长时训练）

# 模型保存与日志
save_model: True           # 保存卫星任务的模型
save_model_interval: 10000 # 每50000步保存一次
verbose: True              # 打印卫星训练日志（轨道参数、奖励、动作 Norm）
weight_decay: True         # 权重衰减（防止过拟合卫星轨迹）
weight_decay_factor: 1.0e-5  # 衰减系数（卫星数据维度高，轻微衰减）

# 评论家网络配置
agent_return_logits: False
q_embed_dim: 1            # Q值嵌入维度（适配卫星高维状态）
noise_clip: 0.5            # 动作噪声裁剪（防止卫星动作超出物理约束）